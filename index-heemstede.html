<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <title>Bevolkingspiramide Heemstede</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <style>
      body {
        font-family: sans-serif;
        background: #f9f9f9;
        padding: 2rem;
        margin: 0;
      }
      .container {
        max-width: 900px;
        margin: auto;
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .vis {
        margin-top: 2rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Bevolkingspiramide Heemstede</h1>
      <div id="vis" class="vis"></div>
    </div>

    <script type="text/javascript">
      const spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "title": "Bevolking Heemstede naar leeftijd en geslacht",
        "width": 700,
        "height": 500,
        "data": {
          "url": "https://raw.githubusercontent.com/Jimvelthuis/cbs-data-heemstede-bloemendaal/refs/heads/main/VegaPyramideHMStab.txt",
          "format": {
            "type": "tsv",
            "parse": {
              "jaar": "number",
              "mannen": "number",
              "vrouwen": "number",
              "leeftijd": "number"
            }
          }
        },
        "transform": [
          { "filter": "datum.jaar == jaar" },
          { "fold": ["mannen", "vrouwen"], "as": ["geslacht", "aantal"] },
          {
            "calculate": "datum.geslacht == 'mannen' ? datum.aantal * -1 : datum.aantal",
            "as": "waarde"
          },
          { "calculate": "datum.jaar - datum.leeftijd", "as": "geboortejaar" },
          {
            "calculate": "if(datum.leeftijd > 99, datum.geboortejaar + ' en eerder', datum.geboortejaar)",
            "as": "_geboortejaartooltip"
          },
          {
            "calculate": "if(datum.leeftijd > 99, '+100', datum.leeftijd)",
            "as": "_leeftijdtooltip"
          }
        ],
        "params": [
          {
            "bind": { "min": 1988, "max": 2024, "step": 1, "input": "range" },
            "name": "jaar",
            "value": 1988
          }
        ],
        "encoding": {
          "y": {
            "field": "leeftijd",
            "type": "ordinal",
            "sort": "descending",
            "axis": {
              "title": "Leeftijd",
              "labelExpr": "datum.value % 10 === 0 ? datum.value : ''",
              "labelFontWeight": "bold",
              "labelFontSize": 12
            }
          },
          "x": {
            "field": "waarde",
            "type": "quantitative",
            "axis": {
              "title": "Aantal mannen en vrouwen",
              "labelExpr": "abs(datum.value)"
            }
          },
          "color": {
            "field": "geslacht",
            "type": "nominal",
            "scale": {
              "domain": ["mannen", "vrouwen"],
              "range": ["#009dec", "#004699"]
            },
            "legend": { "title": "Geslacht" }
          },
          "tooltip": [
            { "field": "_geboortejaartooltip", "title": "Geboortejaar" },
            { "field": "_leeftijdtooltip", "title": "Leeftijd" },
            { "field": "geslacht", "title": "Geslacht" },
            { "field": "aantal", "title": "Aantal" }
          ]
        },
        "mark": { "type": "bar", "height": { "band": 1.3 } }
      };

      vegaEmbed("#vis", spec, { actions: false }).catch(console.error);
    </script>
  </body>
</html>
